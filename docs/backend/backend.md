# ะะพะบัะผะตะฝัะฐััั ะฑะตะบะตะฝะด-ัะฐััะธะฝะธ Monobank Donate

**ะะฐะฒัะณะฐััั ะฟะพ ะดะพะบัะผะตะฝัะฐััั:**
- ๐ **Backend:**
  - **[ะะพะบัะผะตะฝัะฐััั ะฑะตะบะตะฝะดั (ะฟะพัะพัะฝะธะน ะดะพะบัะผะตะฝั)](backend.md)**
- ๐ **Frontend:**
  - [ะะฐะณะฐะปัะฝะธะน ะพะณะปัะด](../frontend/01-overview.md)
  - [ะะพะผะฟะพะฝะตะฝัะธ](../frontend/02-components.md)
  - [ะฅัะบะธ](../frontend/03-hooks.md)
  - [API ะะฝัะตะณัะฐััั](../frontend/04-api-integration.md)
  - [ะกัะธะปัะทะฐััั ัะฐ UI](../frontend/05-styling-ui.md)
  - [ะขะธะฟะธ](../frontend/06-types.md)
  - [Service Workers](../frontend/07-service-workers.md)
- [๐ ะะฐ ะณะพะปะพะฒะฝั](../../README.md)

---

## ะะฐะณะฐะปัะฝะธะน ะพะณะปัะด

ะะตะบะตะฝะด-ัะฐััะธะฝะฐ ะฟัะพะตะบัั Monobank Donate ะฒัะดะฟะพะฒัะดะฐั ะทะฐ ะพััะธะผะฐะฝะฝั ะฐะบััะฐะปัะฝะธั ะดะฐะฝะธั ะฟัะพ ััะฐะฝ ะฑะปะฐะณะพะดัะนะฝะธั ะทะฑะพััะฒ ะท ะฟะปะฐััะพัะผะธ Monobank ัะฐ ะฝะฐะดะฐะฝะฝั ัั ััะพะฝัะตะฝะดั ัะตัะตะท API. ะัะฝะพะฒะฝะฐ ัะตัะฝััะฝะฐ ะทะฐะดะฐัะฐ ะฟะพะปัะณะฐั ั ะฟะฐััะธะฝะณั ะฒะตะฑ-ััะพััะฝะบะธ ะทะฑะพัั ะบะพัััะฒ Monobank ัะฐ ะทะฐะฑะตะทะฟะตัะตะฝะฝั ะฝะฐะดัะนะฝะพะณะพ ั ะฑะตะทะฟะตัะฝะพะณะพ API.

## ะขะตัะฝะพะปะพะณััะฝะธะน ััะตะบ

- **ะะพะฒะฐ ะฟัะพะณัะฐะผัะฒะฐะฝะฝั**: TypeScript
- **ะกะตัะตะดะพะฒะธัะต ะฒะธะบะพะฝะฐะฝะฝั**: Node.js
- **ะะตะฑ-ััะตะนะผะฒะพัะบ**: Express 5.1.0
- **ะะฝััััะผะตะฝั ะฟะฐััะธะฝะณั**: Puppeteer 24.8.0
- **ะัะฑะปัะพัะตะบะธ ะฑะตะทะฟะตะบะธ**:
  - express-rate-limit 7.5.0 (ะทะฐัะธัั ะฒัะด DoS)
  - express-validator 7.2.1 (ะฒะฐะปัะดะฐััั ะฒััะดะฝะธั ะดะฐะฝะธั)
  - express-xss-sanitizer 2.0.0 (ะทะฐัะธัั ะฒัะด XSS)
  - helmet 8.1.0 (ะทะฐัะธัั ัะตัะตะท HTTP-ะทะฐะณะพะปะพะฒะบะธ)
  - cors 2.8.5 (ะบะตััะฒะฐะฝะฝั CORS)

## ะกัััะบัััะฐ ะฟัะพะตะบัั

```
backend/
โโโ index.ts                   # ะัะฝะพะฒะฝะธะน ัะฐะนะป ะดะพะดะฐัะบั
โโโ package.json               # ะะฐะปะฐัััะฒะฐะฝะฝั ะทะฐะปะตะถะฝะพััะตะน
โโโ tsconfig.json              # ะะพะฝััะณััะฐััั TypeScript
โโโ types/
    โโโ express-xss-sanitizer.d.ts  # ะขะธะฟะธ ะดะปั ะผะพะดัะปั express-xss-sanitizer
```

## ะัะฐะณัะฐะผะฐ ะฟะพัะพะบัะฒ ะดะฐะฝะธั

ะะธะถัะต ะฟัะตะดััะฐะฒะปะตะฝะฐ ะดัะฐะณัะฐะผะฐ ะพัะฝะพะฒะฝะพะณะพ ะฟะพัะพะบั ะดะฐะฝะธั ั ะฑะตะบะตะฝะดั:

```
โโโโโโโโโโโโโ         โโโโโโโโโโโโโโโ        โโโโโโโโโโโโโโ         โโโโโโโโโโโโ
โ           โ HTTP    โ             โ HTTPS  โ            โ Parse   โ          โ
โ ะะปััะฝั    โโโโโโโโโโบโ API ัะตัะฒะตั  โโโโโโโโโบโ Monobank   โโโโโโโโโโบโ ะะฑัะพะฑะบะฐ  โ
โ (React)   โโโโโโโโโโโ (Express)   โโโโโโโโโโ Jar ััะพััะฝะบะฐโโโโโโโโโโโ ะดะฐะฝะธั    โ
โ           โ JSON    โ             โ HTML   โ            โ Raw Dataโ          โ
โโโโโโโโโโโโโ         โโโโโโโโโโโโโโโ        โโโโโโโโโโโโโโ         โโโโโโโโโโโโ
                             โ
                             โ ะะพะณัะฒะฐะฝะฝั
                             โผ
                      โโโโโโโโโโโโโโโ
                      โ ะะพะฝัะพะปั     โ
                      โ (ะผะฐะนะฑััะฝั ะะ)โ
                      โโโโโโโโโโโโโโโ

ะะพะผะฟะพะฝะตะฝัะธ ะฑะตะทะฟะตะบะธ (ะทะฐััะพัะพะฒัััััั ะดะพ ะบะพะถะฝะพะณะพ ะทะฐะฟะธัั):
- ะะฐะปัะดะฐััั ะฒััะดะฝะธั ะดะฐะฝะธั (express-validator)
- Rate limiting (express-rate-limit)
- XSS ะทะฐัะธัั (express-xss-sanitizer)
- HTTP ะทะฐะณะพะปะพะฒะบะธ ะฑะตะทะฟะตะบะธ (helmet)
- CORS (cors)
```

## ะะฐะปะฐัััะฒะฐะฝะฝั ัะตัะตะดะพะฒะธัะฐ

### ะะผัะฝะฝั ะพัะพัะตะฝะฝั (.env)

ะัะพะตะบั ะฒะธะบะพัะธััะพะฒัั ะฝะฐัััะฟะฝั ะทะผัะฝะฝั ะพัะพัะตะฝะฝั:

```
# URL ะฑะฐะฝะบะธ ะทะฐ ะทะฐะผะพะฒััะฒะฐะฝะฝัะผ
DEFAULT_JAR_URL=https://send.monobank.ua/jar/YOUR_JAR_ID

# ะะตััะฒะฐะฝะฝั
CACHE_TTL=15

# ะะตะทะฟะตะบะฐ
ALLOWED_ORIGINS=http://localhost:5173,https://your-frontend-domain.com

# ะะตะถะธะผ ัะพะทัะพะฑะบะธ
NODE_ENV=development
```

> **ะัะธะผััะบะฐ:** ะะพัั API ัะตัะฒะตัะฐ (3001) ะถะพัััะบะพ ะทะฐะบะพะดะพะฒะฐะฝะธะน ั ะบะพะดั ั ะฝะต ะฝะฐะปะฐััะพะฒัััััั ัะตัะตะท ะทะผัะฝะฝั ะพัะพัะตะฝะฝั.

### ะััะฐะฝะพะฒะปะตะฝะฝั ัะฐ ะทะฐะฟััะบ

```bash
# ะััะฐะฝะพะฒะปะตะฝะฝั ะทะฐะปะตะถะฝะพััะตะน
npm install

# ะะฐะฟััะบ ะฒ ัะตะถะธะผั ัะพะทัะพะฑะบะธ
npm run dev

# ะะฑััะบะฐ ะดะปั production
npm run build

# ะะฐะฟััะบ ะฒ production
npm start
```

## API ะะพะบัะผะตะฝัะฐััั

### ะััะธะผะฐะฝะฝั ะดะฐะฝะธั ะฟัะพ ะทะฑัั

**ะะฝะดะฟะพัะฝั:** `/api/parse-monobank`

**ะะตัะพะด:** `POST`

**ะััะดะฝั ะดะฐะฝั:**
```json
{
  "url": "https://send.monobank.ua/jar/YOUR_JAR_ID"
}
```
ะะฐัะฐะผะตัั `url` ั ะพะฟััะพะฝะฐะปัะฝะธะผ. ะฏะบัะพ ะฝะต ะฒะบะฐะทะฐะฝะธะน, ะฒะธะบะพัะธััะพะฒัััััั ะทะฝะฐัะตะฝะฝั `DEFAULT_JAR_URL` ะท ะฝะฐะปะฐัััะฒะฐะฝั.

**ะัะดะฟะพะฒัะดั (ััะฟััะฝะฐ):**
```json
{
  "title": "ะะฐะทะฒะฐ ะทะฑะพัั",
  "collected": "48 710 โด",
  "target": "150 000 โด"
}
```

**ะัะดะฟะพะฒัะดั (ะฟะพะผะธะปะบะฐ):**
```json
{
  "error": "Failed to parse page",
  "message": "ะขะตะบัั ะฟะพะผะธะปะบะธ"
}
```

**ะะพะดะธ ะฒัะดะฟะพะฒัะดะตะน:**
- `200 OK` - ะฃัะฟััะฝะพ ะพััะธะผะฐะฝะพ ะดะฐะฝั
- `400 Bad Request` - ะะตะฒััะฝั ะฒััะดะฝั ะดะฐะฝั
- `429 Too Many Requests` - ะะตัะตะฒะธัะตะฝะพ ะปัะผัั ะทะฐะฟะธััะฒ
- `500 Internal Server Error` - ะะพะผะธะปะบะฐ ัะตัะฒะตัะฐ

### ะัะธะบะปะฐะดะธ ะฒะธะบะพัะธััะฐะฝะฝั API

#### ะะธะบะพัะธััะฐะฝะฝั ัะตัะตะท cURL

```bash
# ะะฐะทะพะฒะธะน ะทะฐะฟะธั ะท ะฒะธะบะพัะธััะฐะฝะฝัะผ URL ะทะฐ ะทะฐะผะพะฒััะฒะฐะฝะฝัะผ
curl -X POST http://localhost:3001/api/parse-monobank \
  -H "Content-Type: application/json"

# ะะฐะฟะธั ัะท ะฒะปะฐัะฝะธะผ URL
curl -X POST http://localhost:3001/api/parse-monobank \
  -H "Content-Type: application/json" \
  -d '{"url": "https://send.monobank.ua/jar/ABC123XYZ"}'
```

#### ะะธะบะพัะธััะฐะฝะฝั ัะตัะตะท JavaScript (fetch)

```javascript
// ะัะธะบะปะฐะด ะทะฐะฟะธัั ะท ะฒะธะบะพัะธััะฐะฝะฝัะผ fetch
const fetchData = async () => {
  try {
    const response = await fetch('http://localhost:3001/api/parse-monobank', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        url: 'https://send.monobank.ua/jar/ABC123XYZ'
      })
    });
    
    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.message || 'ะะพะผะธะปะบะฐ ะทะฐะฟะธัั');
    }
    
    const data = await response.json();
    console.log('ะะฐะฝั ะฟัะพ ะทะฑัั:', data);
    return data;
  } catch (error) {
    console.error('ะะพะผะธะปะบะฐ ะฟัะธ ะพััะธะผะฐะฝะฝั ะดะฐะฝะธั:', error);
    throw error;
  }
};
```

#### ะะธะบะพัะธััะฐะฝะฝั ัะตัะตะท Postman

1. ะกัะฒะพัััั ะฝะพะฒะธะน ะทะฐะฟะธั ะฒ Postman
2. ะััะฐะฝะพะฒััั ะผะตัะพะด `POST`
3. ะะฒะตะดััั URL `http://localhost:3001/api/parse-monobank`
4. ะะตัะตะนะดััั ะฝะฐ ะฒะบะปะฐะดะบั `Body`
5. ะะธะฑะตัััั `raw` ั ะฒััะฐะฝะพะฒััั ัะพัะผะฐั `JSON`
6. ะะฒะตะดััั ััะปะพ ะทะฐะฟะธัั:
   ```json
   {
     "url": "https://send.monobank.ua/jar/YOUR_JAR_ID"
   }
   ```
7. ะะฐัะธัะฝััั `Send`

## ะััััะตะบัััะฐ ัะฐ ัะตะฐะปัะทะฐััั

### ะะฑะผะตะถะตะฝะฝั ะทะฐะฟะธััะฒ (Rate Limiting)

ะะตะบะตะฝะด ะผะฐั ะฑะฐะณะฐัะพััะฒะฝะตะฒั ัะธััะตะผั ะพะฑะผะตะถะตะฝะฝั ะทะฐะฟะธััะฒ:

1. **ะะปะพะฑะฐะปัะฝะธะน ะปัะผัั**:
   - 300 ะทะฐะฟะธััะฒ ะทะฐ 15 ัะฒะธะปะธะฝ ั production
   - 1000 ะทะฐะฟะธััะฒ ะทะฐ 15 ัะฒะธะปะธะฝ ั development

2. **ะัะผัั ะดะปั ะตะฝะดะฟะพัะฝัั /api/parse-monobank**:
   - 30 ะทะฐะฟะธััะฒ ะทะฐ 5 ัะฒะธะปะธะฝ ั production
   - 100 ะทะฐะฟะธััะฒ ะทะฐ 5 ัะฒะธะปะธะฝ ั development

3. **ะะฐัะธัั ะฒัะด ะฑััััะพััั**:
   - 20 ะทะฐะฟะธััะฒ ะทะฐ 1 ัะฒะธะปะธะฝั ั production
   - 50 ะทะฐะฟะธััะฒ ะทะฐ 1 ัะฒะธะปะธะฝั ั development

### ะะฐััะธะฝะณ ะดะฐะฝะธั Monobank

ะัะพัะตั ะพััะธะผะฐะฝะฝั ะดะฐะฝะธั ัะบะปะฐะดะฐััััั ะท ะฝะฐัััะฟะฝะธั ะตัะฐะฟัะฒ:

1. **ะะตัะตะฒััะบะฐ ะดะพัััะฟะฝะพััั URL** ะฟะตัะตะด ะทะฐะฟััะบะพะผ Puppeteer
2. **ะะฝัััะฐะปัะทะฐััั Puppeteer** ะท ะพะฟัะธะผัะทะพะฒะฐะฝะธะผะธ ะฟะฐัะฐะผะตััะฐะผะธ ะฑะตะทะฟะตะบะธ
3. **ะะปะพะบัะฒะฐะฝะฝั ะทะฐะนะฒะธั ัะตัััััะฒ** (ะทะพะฑัะฐะถะตะฝะฝั, ััะธััะธ, ะผะตะดัะฐ) ะดะปั ะฟัะธัะฒะธะดัะตะฝะฝั
4. **ะะตัะตััะด ะฝะฐ ััะพััะฝะบั** ะท ัะธััะตะผะพั ะฟะพะฒัะพัะฝะธั ัะฟัะพะฑ ะฟัะธ ะฟะพะผะธะปะบะฐั
5. **ะััะบัะฒะฐะฝะฝั ะทะฐะฒะฐะฝัะฐะถะตะฝะฝั ะบะปััะพะฒะธั ะตะปะตะผะตะฝััะฒ** ััะพััะฝะบะธ
6. **ะะฐััะธะฝะณ ะดะฐะฝะธั** ัะตัะตะท ัะตะปะตะบัะพัะธ ัะฐ ะฟะพััะบ ะทะฐ ัะบะพะฝะบะฐะผะธ
7. **ะะฐะปัะดะฐััั ะพััะธะผะฐะฝะธั ะดะฐะฝะธั** ัะฐ ัะพัะผัะฒะฐะฝะฝั ะฒัะดะฟะพะฒัะดั

#### ะะตัะฐะปัะฝะธะน ะพะฟะธั ะฒะทะฐัะผะพะดัั ะท Puppeteer

Puppeteer ะฒะธะบะพัะธััะพะฒัััััั ะดะปั ะพััะธะผะฐะฝะฝั ะดะฐะฝะธั ะทั ััะพััะฝะบะธ ะทะฑะพัั Monobank. ะัะพัะตั ะฒะทะฐัะผะพะดัั ะฒะบะปััะฐั:

1. **ะะฐะปะฐัััะฒะฐะฝะฝั ะฑัะฐัะทะตัะฐ**:
   ```typescript
   const browser = await puppeteer.launch({ 
     args: [
       '--no-sandbox', 
       '--disable-setuid-sandbox',
       '--disable-dev-shm-usage',
       '--disable-accelerated-2d-canvas',
       '--no-first-run',
       '--no-zygote',
       '--disable-gpu'
     ],
     headless: true
   });
   ```

2. **ะกััะฐัะตะณัั ะฒะธะฑะพัั ัะตะปะตะบัะพััะฒ**:
   
   ะะตะฑ-ััะพััะฝะบะฐ Monobank ะผะฐั ะฝะฐัััะฟะฝั ััััะบัััั ะบะปััะพะฒะธั ะตะปะตะผะตะฝััะฒ:
   
   - ะะฐะณะพะปะพะฒะพะบ ะทะฑะพัั: `header .field.name h1`
   - ะะพะฝัะตะนะฝะตั ััะฐัะธััะธะบะธ: `.jar-stats`
   - ะัะฑัะฐะฝะฐ ััะผะฐ (ะฟะตััะธะน ัะฟะพััะฑ): ัะบะพะฝะบะฐ ะท `collected.svg` โ ะฑะฐััะบัะฒััะบะธะน `.stats-data` โ `.stats-data-value`
   - ะฆัะปัะพะฒะฐ ััะผะฐ (ะฟะตััะธะน ัะฟะพััะฑ): ัะบะพะฝะบะฐ ะท `target.svg` โ ะฑะฐััะบัะฒััะบะธะน `.stats-data` โ `.stats-data-value`
   - ะัะฑัะฐะฝะฐ ััะผะฐ (ัะตะทะตัะฒะฝะธะน ัะฟะพััะฑ): `header .jar-stats > div:nth-child(1) .stats-data-value`
   - ะฆัะปัะพะฒะฐ ััะผะฐ (ัะตะทะตัะฒะฝะธะน ัะฟะพััะฑ): `header .jar-stats > div:nth-child(2) .stats-data-value`

3. **ะะธะฑัั ััะฐะฑัะปัะฝะธั ัะตะปะตะบัะพััะฒ**:
   
   ะัะบัะปัะบะธ ััะพััะฝะบะฐ Monobank ะผะพะถะต ะทะผัะฝัะฒะฐัะธัั, ะฒะธะบะพัะธััะพะฒัััััั ะดะฒะฐ ะฐะปััะตัะฝะฐัะธะฒะฝั ะผะตัะพะดะธ ะดะปั ะพััะธะผะฐะฝะฝั ะดะฐะฝะธั:
   
   - ะะพััะบ ะทะฐ ัะบะพะฝะบะฐะผะธ (ะฑัะปัั ััะฐะฑัะปัะฝะธะน ะผะตัะพะด)
   - ะะพััะบ ะทะฐ ััััะบัััะพั DOM (ัะตะทะตัะฒะฝะธะน ะผะตัะพะด)

4. **ะะฟัะธะผัะทะฐััั ะฟัะพะดัะบัะธะฒะฝะพััั**:
   
   ะะปั ะฟัะธัะบะพัะตะฝะฝั ัะพะฑะพัะธ Puppeteer ะฑะปะพะบัััััั ะทะฐะนะฒั ัะตััััะธ:
   
   ```typescript
   await page.setRequestInterception(true);
   page.on('request', (req) => {
     const resourceType = req.resourceType();
     if (resourceType === 'image' || resourceType === 'font' || resourceType === 'media') {
       req.abort();
     } else {
       req.continue();
     }
   });
   ```

5. **ะะปะณะพัะธัะผะธ ะฟะฐััะธะฝะณั**:

   ะัะฝะพะฒะฝะธะน ะฐะปะณะพัะธัะผ ะดะปั ะฟะพััะบั ะทะฐ ัะบะพะฝะบะฐะผะธ:
   
   ```typescript
   const findValueByIcon = (iconSrc: string): string | null => {
     // ะะฝะฐัะพะดะธะผะพ ะฒัั img ะตะปะตะผะตะฝัะธ
     const icons = Array.from(document.querySelectorAll('.jar-stats img.icon'));
     // ะะฝะฐัะพะดะธะผะพ ัะพะน, ัะบะธะน ะผัััะธัั ะฒะบะฐะทะฐะฝะธะน src
     const targetIcon = icons.find(icon => (icon as HTMLImageElement).src.includes(iconSrc));
     
     if (!targetIcon) return null;
     
     // ะะฝะฐัะพะดะธะผะพ ะฑะฐััะบัะฒััะบะธะน .stats-data
     const statsData = targetIcon.closest('.stats-data');
     if (!statsData) return null;
     
     // ะััะธะผััะผะพ .stats-data-value ะท ััะพะณะพ ะบะพะฝัะตะนะฝะตัะฐ
     const valueElement = statsData.querySelector('.stats-data-value');
     return valueElement ? valueElement.textContent?.trim() || null : null;
   };
   ```

### ะะฟัะธะผัะทะฐััั ัะฐ ััะฐะฑัะปัะฝัััั

#### ะะพะฒะฝะฐ ัะตะฐะปัะทะฐััั ััะฝะบััั ะฟะพะฒัะพัะฝะธั ัะฟัะพะฑ

```typescript
const retry = async <T>(
  fn: () => Promise<T>, 
  maxRetries: number = 3, 
  retryDelay: number = 1000
): Promise<T> => {
  let lastError: Error | null = null;
  
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      return await fn();
    } catch (error) {
      lastError = error instanceof Error ? error : new Error(String(error));
      
      // ะะตัะตะฒััััะผะพ, ัะธ ั ัะต ะผะตัะตะถะตะฒะพั ะฟะพะผะธะปะบะพั, ัะบั ะฒะฐััะพ ะฟะพะฒัะพัะธัะธ
      const errorMessage = lastError.message.toLowerCase();
      const isNetworkError = 
        errorMessage.includes('net::err_socket') || 
        errorMessage.includes('net::err_connection') ||
        errorMessage.includes('net::err_timed_out') ||
        errorMessage.includes('navigation timeout');
      
      // ะฏะบัะพ ัะต ะฝะต ะผะตัะตะถะตะฒะฐ ะฟะพะผะธะปะบะฐ ะฐะฑะพ ะพััะฐะฝะฝั ัะฟัะพะฑะฐ, ะฟัะธะฟะธะฝััะผะพ ัะฟัะพะฑะธ
      if (!isNetworkError || attempt === maxRetries) {
        throw lastError;
      }
      
      // ะะบัะฟะพะฝะตะฝััะนะฝะต ะพััะบัะฒะฐะฝะฝั ะผัะถ ัะฟัะพะฑะฐะผะธ (1ั, 2ั, 4ั...)
      const delay = retryDelay * Math.pow(2, attempt - 1);
      console.warn(`Network error encountered, retrying (${attempt}/${maxRetries}) after ${delay}ms: ${lastError.message}`);
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
  
  // ะฆะตะน ะบะพะด ะฝะต ะฟะพะฒะธะฝะตะฝ ะฒะธะบะพะฝะฐัะธัั, ะฐะปะต TypeScript ะฒะธะผะฐะณะฐั ะฟะพะฒะตัะฝะตะฝะฝั
  throw lastError;
};
```

ะฆั ััะฝะบััั ะทะฐะฑะตะทะฟะตััั ััะฐะฑัะปัะฝัััั ะฟัะด ัะฐั ะผะตัะตะถะตะฒะธั ะฟัะพะฑะปะตะผ ัะปััะพะผ:
1. ะะตะฐะปัะทะฐััั ะตะบัะฟะพะฝะตะฝััะนะฝะพะณะพ ะพััะบัะฒะฐะฝะฝั ะผัะถ ัะฟัะพะฑะฐะผะธ
2. ะะพะทะฟัะทะฝะฐะฒะฐะฝะฝั ะผะตัะตะถะตะฒะธั ะฟะพะผะธะปะพะบ, ัะบั ะผะพะถะฝะฐ ะฟะพะฒัะพัะธัะธ
3. ะะพะณัะฒะฐะฝะฝั ะบะพะถะฝะพั ัะฟัะพะฑะธ ะดะปั ะดัะฐะณะฝะพััะธะบะธ
4. ะะฑะผะตะถะตะฝะฝั ะผะฐะบัะธะผะฐะปัะฝะพั ะบัะปัะบะพััั ัะฟัะพะฑ

#### ะคัะฝะบััั ะฟะตัะตะฒััะบะธ ะดะพัััะฟะฝะพััั URL

```typescript
function checkUrlAvailability(url: string, timeout: number = 5000): Promise<boolean> {
  return new Promise((resolve) => {
    const parsedUrl = new URL(url);
    const options = {
      hostname: parsedUrl.hostname,
      port: parsedUrl.port || 443,
      path: parsedUrl.pathname + parsedUrl.search,
      method: 'HEAD',
      timeout: timeout,
    };

    const req = https.request(options, (res) => {
      // ะะตัะตะฒััััะผะพ HTTP ััะฐััั
      const statusCode = res.statusCode || 0;
      const statusOk = statusCode >= 200 && statusCode < 400;
      resolve(statusOk);
    });

    req.on('error', () => {
      // ะฃ ะฒะธะฟะฐะดะบั ะฟะพะผะธะปะบะธ ะฒะฒะฐะถะฐัะผะพ URL ะฝะตะดะพัััะฟะฝะธะผ
      resolve(false);
    });

    req.on('timeout', () => {
      req.destroy();
      resolve(false);
    });

    req.end();
  });
}
```

ะฆั ััะฝะบััั ะทะฐะฑะตะทะฟะตััั ัะฒะธะดะบั ะฟะตัะตะฒััะบั ะดะพัััะฟะฝะพััั URL ะฟะตัะตะด ะทะฐะฟััะบะพะผ ัะตััััะฝะพะผัััะบะพะณะพ Puppeteer.

### ะะตะทะฟะตะบะฐ

1. **ะะฐะปัะดะฐััั ะฒััะดะฝะธั ะดะฐะฝะธั**:
   ```typescript
   const validateMonobankUrl = [
     body('url')
       .optional()
       .isString()
       .trim()
       .notEmpty()
       .isURL()
       .matches(/^https:\/\/send\.monobank\.ua\/jar\/[a-zA-Z0-9]+$/)
   ];
   ```

2. **XSS-ะทะฐัะธัั**:
   ```typescript
   app.use(xss({ sanitizeRecursively: true }));
   ```

3. **ะะตะทะฟะตัะฝั HTTP-ะทะฐะณะพะปะพะฒะบะธ**:
   ```typescript
   app.use(helmet());
   ```

4. **CORS-ะฝะฐะปะฐัััะฒะฐะฝะฝั**:
   ```typescript
   const corsOptions = {
     origin: process.env.ALLOWED_ORIGINS ? process.env.ALLOWED_ORIGINS.split(',') : '*',
     methods: ['POST', 'OPTIONS'],
     allowedHeaders: ['Content-Type'],
   };
   app.use(cors(corsOptions));
   ```

5. **ะะฑะผะตะถะตะฝะฝั ัะพะทะผััั ะดะฐะฝะธั**:
   ```typescript
   app.use(express.json({ limit: '10kb' }));
   ```

## ะะฑัะพะฑะบะฐ ะฟะพะผะธะปะพะบ ัะฐ ะปะพะณัะฒะฐะฝะฝั

1. **ะะพะณัะฒะฐะฝะฝั ะทะฐะฟะธััะฒ**:
   ```typescript
   app.use((req, res, next) => {
     const start = Date.now();
     res.on('finish', () => {
       const duration = Date.now() - start;
       const logLevel = res.statusCode >= 500 ? 'error' : res.statusCode >= 400 ? 'warn' : 'info';
       console[logLevel](
         `${req.method} ${req.originalUrl} ${res.statusCode} ${duration}ms IP:${req.ip}`
       );
     });
     next();
   });
   ```

2. **ะะฑัะพะฑะบะฐ ะฝะตะฒัะดะพะผะธั ะผะฐััััััะฒ**:
   ```typescript
   app.use((req, res) => {
     res.status(404).json({ error: 'Not found' });
   });
   ```

3. **ะะฑัะพะฑะบะฐ ะฝะตะพััะบัะฒะฐะฝะธั ะฟะพะผะธะปะพะบ**:
   ```typescript
   app.use((err, req, res, _next) => {
     console.error(err.stack);
     res.status(500).json({ 
       error: 'Internal server error',
       ...(process.env.NODE_ENV === 'development' ? { details: err.message } : {})
     });
   });
   ```

## ะะฐะปะฐะณะพะดะถะตะฝะฝั ัะฐ ะดัะฐะณะฝะพััะธะบะฐ

### ะขะธะฟะพะฒั ะฟัะพะฑะปะตะผะธ ัะฐ ัั ัััะตะฝะฝั

#### 1. ะัะพะฑะปะตะผะธ ะท Puppeteer

| ะัะพะฑะปะตะผะฐ | ะะพะถะปะธะฒะฐ ะฟัะธัะธะฝะฐ | ะััะตะฝะฝั |
|---------|-----------------|---------|
| ะะพะผะธะปะบะฐ `Error: net::ERR_CONNECTION_REFUSED` | ะัะพะฑะปะตะผะธ ะท ะผะตัะตะถะตั ะฐะฑะพ ะฝะตะดะพัััะฟะฝัััั Monobank | ะะตัะตะฒัััะต ะฟัะดะบะปััะตะฝะฝั ะดะพ ัะฝัะตัะฝะตัั. ะะฟะตะฒะฝััััั, ัะพ ัะตัะฒัั Monobank ะฟัะฐััั. |
| ะะพะผะธะปะบะฐ `Protocol error: Connection closed` | Puppeteer ะทะฐะฒะตััะธะฒ ัะพะฑะพัั ะดะพ ะทะฐะฒะตััะตะฝะฝั ะพะฟะตัะฐััั | ะะฑัะปััััั ะทะฝะฐัะตะฝะฝั `timeout` ะดะปั ะพะฟะตัะฐััะน. ะะตัะตะฒัััะต ะดะพัััะฟะฝั ัะตััััะธ ัะตัะฒะตัั. |
| `TimeoutError: Navigation timeout` | ะกัะพััะฝะบะฐ ะฟะพะฒัะปัะฝะพ ะทะฐะฒะฐะฝัะฐะถัััััั | ะะฑัะปััััั ะทะฝะฐัะตะฝะฝั `timeout` ั `page.goto()`. ะะตัะตะฒัััะต ัะฒะธะดะบัััั ะผะตัะตะถั. |
| `Error: net::ERR_INSUFFICIENT_RESOURCES` | ะะตะดะพััะฐัะฝัะพ ัะตัััััะฒ ัะธััะตะผะธ | ะะฟัะธะผัะทัะนัะต ะฝะฐะปะฐัััะฒะฐะฝะฝั Puppeteer, ะทะผะตะฝัะธะฒัะธ ะฒะธะบะพัะธััะฐะฝะฝั ะฟะฐะผ'ััั. |
| ะะพะผะธะปะบะธ ะฟะพััะบั ะตะปะตะผะตะฝััะฒ | ะะผัะฝะฐ ััััะบัััะธ ััะพััะฝะบะธ Monobank | ะะฝะพะฒััั ัะตะปะตะบัะพัะธ ะฒัะดะฟะพะฒัะดะฝะพ ะดะพ ะฝะพะฒะพั ััััะบัััะธ ััะพััะฝะบะธ. ะะธะบะพัะธััะพะฒัะนัะต ัะตะทะตัะฒะฝั ะผะตัะพะดะธ ะฟะพััะบั ะตะปะตะผะตะฝััะฒ. |

#### 2. ะััะตะฝะฝั ะดะปั ะดัะฐะณะฝะพััะธะบะธ

1. **ะะฑะตัะตะถะตะฝะฝั ัะบััะฝัะพััะฒ**:
   ```typescript
   if (process.env.NODE_ENV === 'development') {
     await page.screenshot({ path: 'monobank-error.png' });
     console.error('Screenshot saved to monobank-error.png');
   }
   ```

2. **ะะธะฒะตะดะตะฝะฝั ะฒะผัััั ััะพััะฝะบะธ**:
   ```typescript
   const pageContent = await page.content();
   console.log('Page content:', pageContent);
   ```

3. **ะะบะปััะตะฝะฝั ะดะตัะฐะปัะฝะพะณะพ ะปะพะณัะฒะฐะฝะฝั Puppeteer**:
   ```typescript
   const browser = await puppeteer.launch({
     // ัะฝัั ะพะฟััั
     dumpio: true  // ะะธะฒะพะดะธัั stdout ั stderr ะท ะฑัะฐัะทะตัะฐ ะฒ ะบะพะฝัะพะปั
   });
   ```

## ะขะตัััะฒะฐะฝะฝั

### ะกัััะบัััะฐ ัะตัััะฒะฐะฝะฝั

ะะตะบะพะผะตะฝะดะพะฒะฐะฝะฐ ััััะบัััะฐ ัะตัััะฒะฐะฝะฝั ะดะปั ะฑะตะบะตะฝะดั:

1. **ะฎะฝัั-ัะตััะธ**:
   - ะคัะฝะบััั `retry`
   - ะคัะฝะบััั `checkUrlAvailability`
   - ะคัะฝะบััั ะฒะฐะปัะดะฐััั ะดะฐะฝะธั

2. **ะะฝัะตะณัะฐััะนะฝั ัะตััะธ**:
   - ะขะตัััะฒะฐะฝะฝั API ะท ะผะพะบะฐะผะธ Puppeteer
   - ะะตัะตะฒััะบะฐ rate limiting
   - ะะตัะตะฒััะบะฐ ะฟะฐัะฐะผะตัััะฒ ะฑะตะทะฟะตะบะธ

3. **E2E ัะตััะธ**:
   - ะขะตัััะฒะฐะฝะฝั ะฟะพะฒะฝะพะณะพ ะฟะพัะพะบั ะดะฐะฝะธั ะท ัะตะฐะปัะฝะธะผ Monobank API
   - ะะตัะตะฒััะบะฐ ะบะพัะตะบัะฝะพััั ะฟะฐััะธะฝะณั

### ะัะธะบะปะฐะด ัะตััั ะดะปั ััะฝะบััั retry

```typescript
import { expect } from 'chai';
import sinon from 'sinon';

describe('retry function', () => {
  it('should return result on successful call', async () => {
    const fn = sinon.stub().resolves('success');
    const result = await retry(fn, 3, 10);
    expect(result).to.equal('success');
    expect(fn.calledOnce).to.be.true;
  });

  it('should retry on network error', async () => {
    const networkError = new Error('net::err_connection_refused');
    const fn = sinon.stub()
      .onFirstCall().rejects(networkError)
      .onSecondCall().resolves('success');
    
    const result = await retry(fn, 3, 10);
    expect(result).to.equal('success');
    expect(fn.calledTwice).to.be.true;
  });

  it('should throw after max retries', async () => {
    const networkError = new Error('net::err_connection_refused');
    const fn = sinon.stub().rejects(networkError);
    
    try {
      await retry(fn, 3, 10);
      expect.fail('Should have thrown an error');
    } catch (error) {
      expect(fn.callCount).to.equal(3);
      expect(error).to.equal(networkError);
    }
  });
});
```

## ะะฐัััะฐะฑัะฒะฐะฝะฝั

### ะกััะฐัะตะณัั ะผะฐัััะฐะฑัะฒะฐะฝะฝั

1. **ะะพัะธะทะพะฝัะฐะปัะฝะต ะผะฐัััะฐะฑัะฒะฐะฝะฝั**:
   - ะะพะทะณะพััะฐะฝะฝั ะดะตะบัะปัะบะพั ะตะบะทะตะผะฟะปัััะฒ ะฑะตะบะตะฝะดั ะทะฐ ะฑะฐะปะฐะฝััะฒะฐะปัะฝะธะบะพะผ ะฝะฐะฒะฐะฝัะฐะถะตะฝะฝั
   - ะะธะบะพัะธััะฐะฝะฝั ัะพะทะฟะพะดัะปะตะฝะพะณะพ ะบะตััะฒะฐะฝะฝั (Redis, Memcached)
   - ะฆะตะฝััะฐะปัะทะพะฒะฐะฝะต ะปะพะณัะฒะฐะฝะฝั ัะฐ ะผะพะฝััะพัะธะฝะณ

2. **ะะตััะธะบะฐะปัะฝะต ะผะฐัััะฐะฑัะฒะฐะฝะฝั**:
   - ะะฑัะปััะตะฝะฝั ัะตัััััะฒ ะดะปั ะพะฑัะพะฑะบะธ ะฑัะปััะพั ะบัะปัะบะพััั ะฟะฐัะฐะปะตะปัะฝะธั ะทะฐะฟะธััะฒ
   - ะะฟัะธะผัะทะฐััั ะฒะธะบะพัะธััะฐะฝะฝั ะฟะฐะผ'ััั Puppeteer

3. **ะคัะฝะบััะพะฝะฐะปัะฝะต ะผะฐัััะฐะฑัะฒะฐะฝะฝั**:
   - ะะธะดัะปะตะฝะฝั ะฟะฐััะธะฝะณั ะฒ ะพะบัะตะผะธะน ะผัะบัะพัะตัะฒัั
   - ะะฟัะพะฒะฐะดะถะตะฝะฝั ัะตัะณะธ ะทะฐะฒะดะฐะฝั (RabbitMQ, Kafka) ะดะปั ะฐัะธะฝััะพะฝะฝะพั ะพะฑัะพะฑะบะธ
   - ะะตััะฒะฐะฝะฝั ัะตะทัะปััะฐััะฒ ะดะปั ะทะผะตะฝัะตะฝะฝั ะฝะฐะฒะฐะฝัะฐะถะตะฝะฝั ะฝะฐ Monobank

### ะััััะตะบัััะฐ ะดะปั ะผะฐัััะฐะฑัะฒะฐะฝะฝั

```
โโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโ        โโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโ
โ           โ HTTP    โ                โ        โ               โ      โ            โ
โ ะะปััะฝัะธ   โโโโโโโโโโบโ Load Balancer  โโโโโโโโโโบ API ัะตัะฒะตั 1  โโโโ   โ            โ
โ           โโโโโโโโโโโ                โโโโโโโโโโ               โ  โ   โ            โ
โโโโโโโโโโโโโ JSON    โโโโโโโโโโโโโโโโโโ        โโโโโโโโโโโโโโโโโ  โ   โ            โ
                              โ                                     โ   โ            โ
                              โ                 โโโโโโโโโโโโโโโโโ  โ   โ Redis      โ
                              โ                 โ               โ  โ   โ            โ
                              โโโโโโโโโโโโโโโโโโบโ API ัะตัะฒะตั 2  โโโโผโโโบโ (ะะตั)      โ
                                      โ         โ               โ  โ   โ            โ
                                      โ         โโโโโโโโโโโโโโโโโ  โ   โ            โ
                                      โ                            โ   โ            โ
                                      โ         โโโโโโโโโโโโโโโโโ  โ   โ            โ
                                      โ         โ               โ  โ   โ            โ
                                      โโโโโโโโโโบโ API ัะตัะฒะตั N  โโโโ   โ            โ
                                                โ               โ      โ            โ
                                                โโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโ
```

## ะะตััะธะบะธ ะฟัะพะดัะบัะธะฒะฝะพััั

### ะะพัะพัะฝั ะผะตััะธะบะธ

| ะะฟะตัะฐััั | ะกะตัะตะดะฝัะน ัะฐั ะฒะธะบะพะฝะฐะฝะฝั | ะัะบะพะฒะต ะฒะธะบะพัะธััะฐะฝะฝั ัะตัััััะฒ |
|----------|------------------------|------------------------------|
| ะะตัะตะฒััะบะฐ ะดะพัััะฟะฝะพััั URL | ~200-500 ะผั | ะะธะทัะบะต |
| ะะฝัััะฐะปัะทะฐััั Puppeteer | ~1-2 ัะตะบัะฝะดะธ | ะกะตัะตะดะฝั |
| ะะฐะฒะฐะฝัะฐะถะตะฝะฝั ััะพััะฝะบะธ | ~2-5 ัะตะบัะฝะด | ะะธัะพะบะต |
| ะะฐััะธะฝะณ ะดะฐะฝะธั | ~500 ะผั | ะะธะทัะบะต |
| ะะฐะณะฐะปัะฝะธะน ัะฐั ะพะฑัะพะฑะบะธ ะทะฐะฟะธัั | ~3-7 ัะตะบัะฝะด | ะกะตัะตะดะฝั |

### ะะตะบะพะผะตะฝะดะฐััั ะท ะพะฟัะธะผัะทะฐััั

1. **ะะตััะฒะฐะฝะฝั ัะตะทัะปััะฐััะฒ** ะดะปั ะฟะพะฟัะปััะฝะธั ััะพััะฝะพะบ ะทะฑะพััะฒ
2. **ะะฟัะธะผัะทะฐััั ะฝะฐะปะฐัััะฒะฐะฝั Puppeteer** ะดะปั ะบัะฐัะพั ะฟัะพะดัะบัะธะฒะฝะพััั
3. **ะะฟัะพะฒะฐะดะถะตะฝะฝั ัะตัะณะธ ะทะฐะฟะธััะฒ** ะดะปั ะพะฑัะพะฑะบะธ ะฒะธัะพะบะพะณะพ ะฝะฐะฒะฐะฝัะฐะถะตะฝะฝั
4. **ะะพะฝััะพัะธะฝะณ ะบัะธัะธัะฝะธั ะผะตััะธะบ** ะดะปั ะฒะธัะฒะปะตะฝะฝั ะฒัะทัะบะธั ะผัััั
5. **ะะฐัะฐะปะตะปัะฝะฐ ะพะฑัะพะฑะบะฐ ะทะฐะฟะธััะฒ** ะฝะฐ ะพะบัะตะผะธั ัะตัะฒะตัะฐั

## ะะตะบะพะผะตะฝะดะฐััั ัะพะดะพ ัะพะทะณะพััะฐะฝะฝั

1. **ะะฐะปะฐัััะฒะฐะฝะฝั ะทะผัะฝะฝะธั ะพัะพัะตะฝะฝั** (ะพัะพะฑะปะธะฒะพ `ALLOWED_ORIGINS` ะดะปั ะฑะตะทะฟะตะบะธ)
2. **ะะฐะฟััะบ ะทะฐ ะฟัะพัะตัะฝะธะผ ะผะตะฝะตะดะถะตัะพะผ** (pm2 ะฐะฑะพ systemd ะดะปั ะฝะฐะดัะนะฝะพััั)
3. **ะะฐะปะฐัััะฒะฐะฝะฝั ะทะฒะพัะพัะฝะพะณะพ ะฟัะพะบัั** (nginx/apache) ะท SSL-ัะตััะธััะบะฐัะฐะผะธ
4. **ะะพะฝััะพัะธะฝะณ** ะฝะฐ ะฟะพัะตะฝััะนะฝั DoS ะฐัะฐะบะธ ัะฐ ะฐะฝะพะผะฐะปัะฝั ะฐะบัะธะฒะฝัััั

### ะัะธะบะปะฐะด ะบะพะฝััะณััะฐััั PM2

```json
{
  "apps": [
    {
      "name": "monobank-donate-backend",
      "script": "dist/index.js",
      "instances": "max",
      "exec_mode": "cluster",
      "watch": false,
      "max_memory_restart": "300M",
      "env": {
        "NODE_ENV": "production"
      }
    }
  ]
}
```

### ะัะธะบะปะฐะด ะบะพะฝััะณััะฐััั Nginx

```nginx
server {
    listen 80;
    server_name api.your-domain.com;

    location / {
        return 301 https://$host$request_uri;
    }
}

server {
    listen 443 ssl;
    server_name api.your-domain.com;

    ssl_certificate /path/to/certificate.crt;
    ssl_certificate_key /path/to/private.key;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    location / {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # ะะฐัะธัั ะฒัะด DoS ะฐัะฐะบ
        limit_req zone=api burst=20 nodelay;
        limit_conn addr 10;
    }
}
```

## ะะปะฐะฝะธ ะท ัะพะทะฒะธัะบั

1. **ะะตััะฒะฐะฝะฝั ัะตะทัะปััะฐััะฒ** ะดะปั ะทะผะตะฝัะตะฝะฝั ะฝะฐะฒะฐะฝัะฐะถะตะฝะฝั ะฝะฐ Monobank
2. **ะะฑะตััะณะฐะฝะฝั ัััะพััั ะทะฑะพััะฒ** ั ะฑะฐะทั ะดะฐะฝะธั ะดะปั ะฐะฝะฐะปััะธะบะธ
3. **ะะพะทัะธัะตะฝะฝั ััะฝะบััะพะฝะฐะปัะฝะพััั API** ะดะปั ะฑัะปััะพั ัะฝัะพัะผะฐััั ะฟัะพ ะทะฑะพัะธ
4. **ะะพะฝััะพัะธะฝะณ ัะฐ ะปะพะณัะฒะฐะฝะฝั** ะดะปั ะฒัะดััะตะถะตะฝะฝั ะฟะพะผะธะปะพะบ
5. **ะะพะฝัะตะนะฝะตัะธะทะฐััั** ะดะปั ัะฟัะพัะตะฝะฝั ัะพะทะณะพััะฐะฝะฝั
6. **ะะตะฐะปัะทะฐััั WebSocket API** ะดะปั ัะตะฐะปัะฝะพะณะพ ัะฐัั
7. **ะะฝัะตะณัะฐััั ะท ัะฝัะธะผะธ ะฟะปะฐััะพัะผะฐะผะธ ะทะฑะพััะฒ**
8. **ะะฟัะพะฒะฐะดะถะตะฝะฝั ะณัะฐััะบัะฒ ัะฐ ะฐะฝะฐะปััะธะบะธ** 